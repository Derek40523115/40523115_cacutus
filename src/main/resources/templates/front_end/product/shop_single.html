<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
<html>

<head>
    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <title>ShopSingle</title>
	<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>

</head>

<body>

  			<ul class="navbar-nav ml-auto">
                   
                    <li class="nav-item">
                        <a class="nav-link" th:href="@{/shopCart/shopCart}" id="toShopCart">
                        	<label>購物車在這:</label>
                            <span class="lnr lnr-cart"></span>
                        </a>
                    </li>
                </ul>
           

<!--==================================================================================-->



<div class="product-details">
    <div class="image-container">
<!--         <img th:if="${not #sets.isEmpty(product.pdImages)}" th:each="image : ${imagePaths}" -->
<!--              th:src="@{'data:image/jpeg;base64,' + ${image}}" alt="商品圖片" class="active shop"> -->
<!--         <img th:unless="${not #sets.isEmpty(product.pdImages)}" -->
<!--              src="/shop_19/images/nopic.jpg" alt="" class="img-responsive"> -->
        <button class="prev-button"> <</button>
        <button class="next-button"> ></button>
    </div>
    <div class="product-options">
        <h2 id="productName" th:text="${product.productName}"></h2>
        <p style="margin-bottom: 20px" th:text="'商品編號：'+${product.productId}"></p>
        <input type="hidden" id="productId" th:value="${product.productId}" style="display: none;">
<!--         <p style="margin: 20px 0px 20px 0px" class="product-category" -->
<!--            th:text="'商品類別：'+${product.category.categoryName}"></p> -->
        <div style="margin: 20px 0px 20px 0px">
            <label for="detail">商品細節描述：</label>
            <p id="detail" th:text="${product.shopOrderDetailVO}" style="width: 600px"></p>
        </div>
        <div style="margin: 20px 0px 20px 0px">
            <label for="quantity">數量:</label>
            <input type="number" id="quantity" min="1" max="5" value="1">
        </div>
        <div class="info-product-price">
            <label>價錢:</label>
            <span th:text="'$'+${product.productPrice}"></span>
            <input type="hidden" id="price" th:value="${product.productPrice}" style="display: none;">
        </div>
        <div class="btn-container">
            <button class="add-to-cart">加入購物車</button>
        </div>
    </div>

</div>

<!--==================================================================================-->


<script>
    const quantityInput = document.getElementById("quantity");
    quantityInput.addEventListener("change", function () {
        var value = parseInt(quantityInput.value);
        if (value < 1) {
            quantityInput.value = "1";
        } else if (value > 5) {
            quantityInput.value = "5";
            alert("單項商品購買數量不得超過5")
        }
    });

    // 綁定「加入購物車」按鈕的點擊事件
    const addToCartButtons = document.querySelectorAll('.add-to-cart');
    addToCartButtons.forEach(button => {
        button.addEventListener('click', addToCart);
    });


    // 加入購物車的處理函式
    function addToCart(event) {
        // 獲取商品資訊
        const productId = document.getElementById("productId").value;
        const productName = document.getElementById("productName").textContent;
        const price = document.getElementById("price").value;
        const quantity = document.getElementById("quantity").value;

        var cartItem = {
            productId: productId,
            quantity: quantity,
            productName: productName,
            price: price
        };

        jQuery.ajax({
            url: "/shopCart/addOneToCart",
            type: "POST",
            contentType: "application/json",
            data: JSON.stringify(cartItem),
            success: function (response) {
                //有空再換sweet alert啦
                if (response) {
                    alert("商品已添加到購物車！");
                } else {
                    alert("尚未登入會員，請登入");
                    window.location.href = '/front_end/member/memberLogin';
                }
            },
            error: function () {
                alert("添加商品到購物車失敗！");
            }
        });

    }

</script>


</body>

</html>