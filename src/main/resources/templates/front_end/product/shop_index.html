<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
<html>

<head>
    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <title>ShopAll</title>
	<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
	
</head>



<body>

  				<ul class="navbar-nav ml-auto">
                   
                    <li class="nav-item">
                        <a class="nav-link" th:href="@{/shopCart/shopCart}" id="toShopCart">
                        	<label>購物車在這:</label>
                            <span class="lnr lnr-cart"></span>
                        </a>
                    </li>
                </ul>
           

<!--==================================================================================-->



    <div class="container">
        <!-- product right -->
        <div class="agileinfo-ads-display col-md-9">
            <div class="wrapper">
                <!-- section product -->
                <div class="product-sec1" id="product-container">

                    <div class="col-md-4 product-men" th:each="product, index:${productList.stream().toArray()}">
                        <input type="hidden" class="addToCartId" name="productId" th:value="${product.productId}"/>
                        <div class="men-pro-item simpleCart_shelfItem">
                            <div class="men-thumb-item">
                            
                                <img th:src="@{/product/ShowProductPic} + '?productId=' + ${product.productId}" width="100px" class="img-responsive">
                                

                               
                            </div>
                            
                            <div class="item-info-product ">
                                <h4>
                                    <a th:onclick="'window.location.href=\'/shopSingleProduct/' + ${product.productId} + '\''"
                                       th:text="${product.productName}"></a>
                                </h4>
                                <div class="info-product-price">
                                    <span class="item_price" th:text="'$'+${product.productPrice}"></span>
                                </div>
                                <div>
                                    <button type="button" name="submit" class="cart_btn">加入購物車</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="clearfix"></div>
                </div>
            </div>
        </div>
        <!-- //product right -->
    </div>
</div>
<!-- //top products -->


<!--==================================================================================-->






<!--======按下加入購物車會發出請求傳一個DTO到後端，存到Redis的購物車陣列=========-->
<script>
    jQuery(".cart_btn").click(function addToCart() {

        var productId = jQuery(this).closest(".product-men").find(".addToCartId").val(); // 商品ID

        var cartItem = {
            productId: productId,
            quantity: 1,
        };
        jQuery.ajax({
            url: "/shopCart/addOneToCart",
            type: "POST",
            contentType: "application/json",
            data: JSON.stringify(cartItem),
            success: function (response) {
                //有空再換sweet alert啦
                if (response) {
                    alert("商品已添加到購物車！");
                } else {
                    alert("尚未登入會員，請登入");
                    window.location.href = '/front_end/member/memberLogin';
                }
            },
            error: function () {
                alert("添加商品到購物車失敗！");
            }
        });
    });

</script>


</body>

</html>